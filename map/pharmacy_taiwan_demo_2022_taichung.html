
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>臺中市區的藥局地圖</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { background-image: url('https://source.unsplash.com/featured/?forest,greenfield'); background-size: cover; font-family: Arial, sans-serif; }
        .wrapper { max-width: 1200px; margin: auto; padding: 20px; background-color: rgba(255, 255, 255, 0.8); border-radius: 15px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
        .title { color: #2b8a3e; text-align: center; margin: 20px 0; }
        .map-container { display: flex; justify-content: center; align-items: center; margin: 20px auto; }
        #map { width: 100%; height: 500px; }
        .footer { text-align: center; margin-top: 20px; font-size: 0.8em; }
        .filter-container { text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>
<div class="wrapper">
    <div class="title">
        <h1>🌿 臺中市區的藥局地圖 🌿</h1>
        <p>有需要醫療資源，口罩、成藥等可以在這邊取得喔！</p>
    </div>

    <div class="filter-container">
        <label for="district-select">選擇鄉鎮市區:</label>
        <select id="district-select">
            <option value="all">全部</option>
        </select>
    </div>

    <div class="map-container">
        <div id="map"></div>
    </div>

    <div class="footer">
        Generated by <a href="https://intro.botrun.ai/" target="_blank">Botrun.ai</a>
    </div>
</div>

<script>
    Plotly.d3.csv('https://wengroy.github.io/civilmap/pharmacy_taiwan_demo_2022.csv', function(err, rows){
        function unpack(rows, key) {
            return rows.map(function(row) { return row[key]; });
        }

        var allDistricts = [...new Set(rows.filter(row => row['縣市'] === '臺中市').map(row => row['鄉鎮市區']))];
        var districtSelect = document.getElementById('district-select');
        allDistricts.forEach(function(district) {
            var option = document.createElement('option');
            option.value = district;
            option.text = district;
            districtSelect.appendChild(option);
        });

        function updateMap(district) {
            var filteredRows = rows.filter(row => row['縣市'] === '臺中市' && (district === 'all' ? true : row['鄉鎮市區'] === district));
            var data = [
            {
                type: 'scattermapbox',
                lat: unpack(filteredRows, 'lat'),
                lon: unpack(filteredRows, 'lon'),
                mode: 'markers',
                marker: {
                    size: 10,
                    color: '#fe0000'
                },
                text: unpack(filteredRows, 'name')
            }];

            var layout = {
                mapbox: {
                    style: 'open-street-map',
                    center: { lat: 24.147736, lon: 120.673648 },
                    zoom: 10
                },
                margin: { r: 0, t: 0, l: 0, b: 0 }
            };
            
            Plotly.newPlot('map', data, layout, {responsive: true});
        }

        districtSelect.addEventListener('change', function() {
            updateMap(this.value);
        });

        // Initial map update with 'all' option
        updateMap('all');
    });
</script>
</body>
</html>
